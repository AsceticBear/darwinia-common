const expect = require("chai").expect;
const assert = require("chai").assert;
const Web3 = require("web3");
const conf = require("./config.js");
const web3 = new Web3(conf.host);
const account = web3.eth.accounts.wallet.add(conf.privKey);
// call bytecode
const bytecode =
	"608060405234801561001057600080fd5b50610134806100206000396000f3fe608060405260043610601c5760003560e01c80633ccfd60b146021575b600080fd5b60276029565b005b602f60ba565b603560dc565b7f723908ee9dc8e509d4b93251bd57f68c09bd9d04471c193fabd8f26c54284a4b81600060018110608f577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200201818152505060408260208368022b1c8c1227a000006005600019f160b657600080fd5b5050565b6040518060600160405280600390602082028036833780820191505090505090565b604051806020016040528060019060208202803683378082019150509050509056fea26469706673582212200449a98b0d3ae69c53058cf173ce2518a0cc1714264f96392f87c674fa3f787664736f6c63430008010033";
// delegate call bytecode
// const bytecode =
// 	"608060405234801561001057600080fd5b5061012a806100206000396000f3fe608060405260043610601c5760003560e01c80633ccfd60b146021575b600080fd5b60276029565b005b602f60b0565b603560d2565b7f723908ee9dc8e509d4b93251bd57f68c09bd9d04471c193fabd8f26c54284a4b81600060018110608f577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b6020020181815250506040826020836005600019f460ac57600080fd5b5050565b6040518060600160405280600390602082028036833780820191505090505090565b604051806020016040528060019060208202803683378082019150509050509056fea26469706673582212206d679011a6c31ca592e5775c5bea8bf557b43d642b6b69b1c3141fffa595af2b64736f6c63430008010033";
const abi = [
	{
		inputs: [],
		name: "withdraw",
		outputs: [],
		stateMutability: "payable",
		type: "function",
	},
];
const jsontest = new web3.eth.Contract(abi);
jsontest.options.from = conf.address;
jsontest.options.gas = conf.gas;

describe("Test Transfer Contract", function () {
	after(() => {
		web3.currentProvider.disconnect();
	});
	it("Deploy transfer back contract", async function () {
		const instance = await jsontest
			.deploy({
				data: bytecode,
				arguments: [],
			})
			.send();
		jsontest.options.address = instance.options.address;
		console.log("contract address {}", jsontest.options.address);
	}).timeout(10000);
	it("Transfer back", async function () {
		await jsontest.methods.withdraw().send({
			value: 40000000000000000000,
		});
	}).timeout(80000);
});